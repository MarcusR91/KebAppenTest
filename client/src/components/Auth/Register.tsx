import axios from "axios"
import { useContext } from "react";
import { useHistory } from "react-router-dom";
import { urlAccounts } from "../../Endpoints"
import { authenticationResponse, userCredentials } from "./Auth.model"
import Authcontext from "./AuthContext";
import { AuthForm } from "./AuthForm";
import { getClaim, SaveToken } from "./HandleJwt";


export const Register = () => {

    const {update} = useContext(Authcontext);
    const history = useHistory();

    async function register(credentials:userCredentials){
        try{
            const response = await axios.post<authenticationResponse>(`${urlAccounts}/create`, credentials);
            SaveToken(response.data);
            update(getClaim());
            history.push('/')
        }
        catch(error){

        }

    }

    return(
        <>
        <h3>Register</h3>
        <AuthForm
            model={{email:'', password:''}}
            onSubmit={async values => await register(values)}
        />
        </>
    )
}