import axios from "axios"
import { useContext } from "react"
import { useHistory } from "react-router-dom"
import { urlAccounts } from "../../Endpoints"
import { authenticationResponse, userCredentials } from "./Auth.model"
import Authcontext from "./AuthContext"
import { AuthForm } from "./AuthForm"
import { getClaim, SaveToken } from "./HandleJwt"


export const Login =() => {

    const {update} = useContext(Authcontext);
    const history = useHistory();

    async function login(credentials: userCredentials){
        try{
            const response = await axios.post<authenticationResponse>(`${urlAccounts}/login`, credentials);
            SaveToken(response.data);
            update(getClaim());
            history.push("/")
        }catch(error){

        }

    }

    return(
        <>
        <h3>Login</h3>
        <AuthForm
            model={{email: '', password: ''}}
            onSubmit={async values => await login(values)}
        />
        </>
    )
}