import axios, { AxiosResponse } from "axios";
import { useEffect, useState } from "react"
import { urlOrders } from "../../Endpoints";
import { Button } from "../utils/Button";
import GenericList from "../utils/GenreicList";
import { OrderCreationDto } from "./Models/order.model";
import jsPDF from 'jspdf';
import autoTable from 'jspdf-autotable'

export const FilterOrders = () => {

    const [orders, setOrders] = useState<OrderCreationDto[]>();


    useEffect(() => {
        loadOrders();
    }, [orders])

    const loadOrders = () => {
        axios.get(urlOrders)
            .then((response: AxiosResponse<OrderCreationDto[]>) => {
                setOrders(response.data);
            })
    }

    const DeleteOrder = async (id: number) => {
        try {
            axios.delete(`${urlOrders}/${id}`);
        } catch (error) {
            console.error(error);
        }
    }

    const exportData = () => {
        const doc = new jsPDF()
        autoTable(doc, { html: "#orderTable" })
        doc.save("order.pdf");
    }

    return (
        orders ? <>
            <h3>Alla ordrar</h3>
            <div>
                <Button onClick={() => exportData()}
                    className="btn btn-success">Exportera som pdf</Button>
            </div>
            <GenericList list={orders}>
                <table className="table table-striped" id="orderTable">
                    <thead>
                        <tr>
                            <th>Namn:</th>
                            <th>Ant√§llningsnummer:</th>
                            <th>Kebab:</th>
                            <th>Dricka:</th>
                        </tr>
                    </thead>
                    <tbody>{orders?.map((order, index) =>
                        <tr key={order.id}>
                            <td>{order.firstName} {order.lastName}</td>
                            <td>{order.empNr}</td>
                            <td>{order.name}</td>
                            <td>{order.typeOfDrink}</td>
                            <td><Button onClick={() => DeleteOrder(order.id)}
                                className="btn btn-danger">Ta bort</Button></td>
                        </tr>
                    )}
                    </tbody>
                </table>
            </GenericList>
        </> : <h6>Inga ordrar att visa</h6>
    )
}