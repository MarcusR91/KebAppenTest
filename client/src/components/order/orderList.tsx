import axios, { AxiosResponse } from "axios";
import { useEffect, useState } from "react";
import { urlDeleteAllOrders } from "../../Endpoints";
import { Button } from "../utils/Button";
import GenericList from "../utils/GenreicList";
import { SummedOrderDto } from "./Models/order.model"

export const OrderList = () => {

    const [summedOrder, setSummedOrder] = useState<SummedOrderDto[]>();

    useEffect(() => {
        loadOrders();
    })

    const loadOrders = () => {
        axios.get("https://localhost:7117/api/Order/kebabs")
            .then((response: AxiosResponse<SummedOrderDto[]>) => {
                setSummedOrder(response.data);
            })
    }

    const deleteAllOrders= () => {
        try {
            axios.delete(urlDeleteAllOrders)
        } catch (error) {
            console.error(error);
        }
    }

        return (
        summedOrder ?  <>
                <h1>Summering</h1>
                <Button onClick={() => deleteAllOrders()} className="btn btn-danger mt-3">Delete all Orders</Button>
                <div>
                    <GenericList list={summedOrder}>
                        <table className="table table-striped">
                            <thead>
                                <tr>
                                    <th>Kebab:</th>
                                    <th>Antal:</th>
                                </tr>
                            </thead>
                            <tbody>{summedOrder?.map((order, index) =>
                                <tr key={index}>
                                    <td>{order.name}</td>
                                    <td>{order.count}</td>
                                </tr>
                            )}
                            </tbody>
                        </table>
                    </GenericList>
                </div>
            </> : <h3>Finns för tillfället ingen data att visa</h3> 
        )
}