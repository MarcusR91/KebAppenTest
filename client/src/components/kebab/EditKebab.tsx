import axios, { AxiosResponse } from "axios";
import { useEffect, useState } from "react";
import { useHistory, useParams } from "react-router-dom"
import { urlKebabs } from "../../Endpoints";
import { Loading } from "../utils/Loading";
import { KebabForm } from "./KebabForm";
import { KebabCreationDto, KebabDto } from "./Models/Kebab.model";

export const EditKebab = () => {

    const {id}: any = useParams();

    const [kebab, setKebab] = useState<KebabCreationDto>();
    const history = useHistory();

    useEffect(()=>{
        axios.get(`${urlKebabs}/${id}`)
        .then((response: AxiosResponse<KebabDto>) =>{
            setKebab(response.data);

        })
    },[id])

    const edit = async (kebabToEdit: KebabCreationDto) => {
        try {
            await axios.put(`${urlKebabs}/${id}`, kebabToEdit);
            history.push("/kebabs");
        } catch (error) {
                console.error(error)
            
        }
    }

    return(
        <>
            <h3>Redigera Kebab</h3>
           
           {kebab ?  <KebabForm model = {kebab} // Passing state of kebab into our model type (kebabCreationDto) 
            onSubmit={async value =>{
            await edit(value);
           }}/> : <Loading />}
           
        </>
    )
}