import React, { useEffect, useState } from 'react';
import { BrowserRouter, Route, Switch } from 'react-router-dom';
import './App.css';
import { Menu } from './components/Menu/menu';
import configureValidation from './Validations/Validations';
import { claim } from './components/Auth/Auth.model';

import routes from './components/Menu/route-config';
import Authcontext from './components/Auth/AuthContext';
import { getClaim } from './components/Auth/HandleJwt';
import configureInterceptor from './components/utils/httpInterceptors';

configureValidation();
configureInterceptor();

const App = () => {

  const [claims, setClaims] = useState<claim[]>([]);

  useEffect(()=>{
    setClaims(getClaim());
  },[]);

  const isAdmin = () =>  {
    return claims.findIndex(claim => claim.name === "role" && claim.value === "admin") > -1
  }

  return (
    <BrowserRouter >
    <Authcontext.Provider value={{claims, update: setClaims}}>

    
      <Menu />
      <div className='container'>
        <Switch>
          {routes.map(route => 
          <Route key= {route.path} path={route.path} exact={route.exact}>
            {route.isAdmin && !isAdmin() ? 
            <>You are not allowd to see this page</> :
            <route.component />
            }
          </Route>)}
        </Switch>
      </div>
      </Authcontext.Provider>
    </BrowserRouter>
  );
}

export default App;
